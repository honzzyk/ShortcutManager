/*! scm 2017-12-12 */
var SC={};SC.Store=function(a,b){"use strict";function c(a,b){var c=a[b];return c||(c=[],a[b]=c),c}function d(a){var b;for(b=0;b<a.length;b++)if(a[b].isDefault)return!0;return!1}function e(a,b){return a[b]||null}function f(b,d,e,f){var g,h,i=c(b,e),j=i.length;if(d===a.scdefault)return void(i.length=0);for(g=j-1;g>=0;g--)h=i[g],h.context===d&&h.handler===f&&i.splice(g,1),f||h.context!==d||i.splice(g,1)}function g(a,b){var c=a[b];c&&0===c.length&&delete a[b]}function h(b,c){var d,e,f,g=c===a.scdefault;for(e in b)if(b.hasOwnProperty(e)){for(f=b[e],d=f.length-1;d>=0;d--)(f[d].context===c||g)&&f.splice(d,1);0===f.length&&delete b[e]}}function i(a,b,e,f,g){var h=c(a,b[0]),i=d(h),j=new o(e,f,b[1],b[2],g);if(g){if(!i)return void h.unshift(j);throw"ShortcutManager: Can not add another default handler for shortcut "+b+"."}h.push(j)}function j(a,b,c,d){void 0!==b[0]&&null!==b[0]?f(a,c,b[0],d):h(a,c),g(a,b[0])}function k(a){var b,c,d=l(a),e=[];for(b=0;b<d.length;b++)c=d[b],e=e.concat(c&&c.match(s)?m(c):n(c));return e}function l(a){return a?a.split(r):[null]}function m(a){var b,c,d,e,f,g,h=[];for(d=s.exec(a),g=d[1],f=d[2].split(q),e=parseInt(f[0],10),c=parseInt(f[1],10),b=e;c>=b;b++)h.push([a.replace(g,b),b,e]);if(0===h.length)throw"Regex shortcut do not match any handler.";return h}function n(a){var b=[];return b.push([a||null,-1,-1]),b}function o(a,b,c,d,e){this.isDefault=e||!1,this.from=d,this.modifier=c,this.context=a,this.handler=b}function p(){this.store={}}var q="..",r=", ",s=/.*\+(\[([0-9]..[0-9])\])/g;return b=p.prototype,b.save=function(a,b,c,d){var e,f=k(a);for(e=0;e<f.length;e++)i(this.store,f[e],b,c,d)},b.get=function(a){return e(this.store,a)},b.exists=function(a){return Boolean(this.store[a])},b.remove=function(a,b,c){var d,e=k(b);for(d=0;d<e.length;d++)j(this.store,e[d],a,c)},p}(SC),SC.Normalizer=function(a,b){"use strict";function c(a){return l[a]}function d(a){return a>=96&&105>=a?a-48:a}function e(a){var b=n[a];return a=d(a),b?b:String.fromCharCode(a).toLowerCase()}function f(a){return Boolean(o[a])}function g(){}function h(a){var b,d,e,f,g=[],h=[];if(a===j)return j;for(e=a.toLowerCase().split(j),b=0;b<e.length;b++)f=c(e[b]),void 0!==f?g[f]=e[b]:(d=i(e[b]),h.push(d));return g=g.concat(h),g=g.filter(function(a){return a}),g.join(j)}function i(a){return m[a]||a}var j="+",k=", ",l={ctrl:0,alt:1,shift:2},m={enter:"return"},n={8:"backspace",9:"tab",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",106:"*",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",107:"+",109:"-",187:"+",188:",",189:"-",190:".",191:"/"},o={187:"+"};return b=g.prototype,b.fromEvent=function(a){var b,c=!f(a.keyCode);return b=a.ctrlKey?"ctrl+":"",b+=a.altKey?"alt+":"",b+=a.shiftKey&&c?"shift+":"",b+=e(a.keyCode)},b.normalize=function(a){var b,c;if(void 0===a||null===a)return a;for(c=a.split(k),b=0;b<c.length;b++)c[b]=h(c[b]);return c.join(k)},g}(SC),SC.Manager=function(a,b){"use strict";function c(b){this.context=a.scdefault,this.layer=h,this.isStatic=b||!1}function d(a){j&&console.debug(a)}function e(b){var c=b;return(b===window||b===document)&&(c="[window]"),b===document.body&&(c="[body]"),"string"!=typeof b&&(c=g(b)),k[c]=k[c]||new a.Store,k[c]}function f(){return 0===l.length?e(a.sclayer):l[l.length-1]}function g(a){for(var b,c,d=a.nodeName,e=a.parentNode;e;)c=e.className?"."+e.className:"",b=e.id?"#"+e.id:"",d=e.nodeName+b+c+"/"+d,e=e.parentNode;return d||a}var h,i=new a.Normalizer,j=!1,k={},l=[];return a.scdefault=window,a.sclayer=window,h=e(a.sclayer),b=c.prototype,b.create=function(b,c){return(new a.Manager)["in"](b,c)},b["in"]=function(b,c){if(this.isStatic)throw"ShortcutManager: Can not change context on static method. Use ShortcutManager.create() with right context.";return this.context=b,this.layer=e(c||a.sclayer),this},b.on=function(a,b,c){var e=i.normalize(a);this.layer.save(e,this.context,b,c),d("ShortcutManager: Register "+a)},b.activate=function(){var a;return h===this.layer?(l=[],void d("ShortcutManager: Activating main layer store.")):(a=l.indexOf(this.layer),void(-1===a?l.push(this.layer):l.splice(a+1)))},b.deactivate=function(){var a;if(h===this.layer)throw"ShortcutManager: Can not deactivate main layer. This is invalid call of deactivate method.";if(a=l.indexOf(this.layer),-1===a)throw"ShortcutManager: Can not deactivate layer because is not an active layer.";l.splice(a)},b.normalize=function(a){return"object"==typeof a?i.fromEvent(a):i.normalize(a)},b.remove=function(a,b){var c=i.normalize(a);this.layer.remove(this.context,c,b),d("ShortcutManager: Remove "+a)},b.event=function(a){var b,c,e,g,h=i.fromEvent(a);if(h)if(c=f().get(h),c&&c.length){for(d("ShortcutManager: Trying to handle '"+h+"' shortcut,","available handlers:"),g=c.length-1;g>=0;g--){if(b=c[g],e=b.handler(h,b.modifier,b.from))return d("ShortcutManager: Handler with index '"+g+"' handled shortcut, handler: "),d(b.handler),!0;d("ShortcutManager: Handler with index '"+g+"' returned false...trying next")}d("ShortcutManager: There is no more handler to try, returning false")}else d("ShortcutManager: There is no handler for '"+h+"' shortcut");return!1},b.exists=function(a){var b;return"object"==typeof a&&(a=i.fromEvent(a)),"string"==typeof a&&(a=i.normalize(a)),b=f().exists(a),d(b?"ShortcutManager: Shortcut '"+a+"' is registered":"ShortcutManager: Shortcut '"+a+"' is not registered"),b},b.destroy=function(){this.remove()},b.debugMode=function(a){j=a,console.info("ShortcutManager debug mode is set to "+(a?"on":"off"))},c}(SC);var ShortcutManager=new SC.Manager(!0);