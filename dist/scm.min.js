/*! @sedlak.r/scm@1.0.3 2024-04-30 */
globalThis.SC&&console.warn("SC already exists on globalThis, redefining"),globalThis.SC={},SC.Store=function(m,t){"use strict";var c="..",i=", ",s=/.*\+(\[([0-9]..[0-9])\])/g;function p(t,e){var n=t[e];return n||(t[e]=n=[]),n}function l(t,e,n,r,o){var t=p(t,e[0]),a=function(t){for(var e=0;e<t.length;e++)if(t[e].isDefault)return!0;return!1}(t),n=new h(n,r,e[1],e[2],o);if(o){if(a)throw"ShortcutManager: Can not add another default handler for shortcut "+e+".";t.unshift(n)}else t.push(n)}function a(t,e,n,r){if(void 0!==e[0]&&null!==e[0]){var o,a,i=t,c=n,s=e[0],l=r,u=p(i,s),i=u.length;if(c===m.scdefault)u.length=0;else for(o=i-1;0<=o;o--)(a=u[o]).context===c&&a.handler===l&&u.splice(o,1),l||a.context!==c||u.splice(o,1)}else{var h,f,d,g=t,v=n,y=v===m.scdefault;for(f in g)if(g.hasOwnProperty(f)){for(h=(d=g[f]).length-1;0<=h;h--)d[h].context!==v&&!y||d.splice(h,1);0===d.length&&delete g[f]}}r=t,s=e[0],(i=r[s])&&0===i.length&&delete r[s]}function u(t){for(var e,n,r=(t=t)?t.split(i):[null],o=[],a=0;a<r.length;a++)o=(e=r[a])&&e.match(s)?o.concat(function(t){var e,n,r,o,a,i=[];for(o=s.exec(t),a=o[1],o=o[2].split(c),r=parseInt(o[0],10),n=parseInt(o[1],10),e=r;e<=n;e++)i.push([t.replace(a,e),e,r]);if(0!==i.length)return i;throw"Regex shortcut do not match any handler."}(e)):o.concat((e=e,void 0,(n=[]).push([e||null,-1,-1]),n));return o}function h(t,e,n,r,o){this.isDefault=o||!1,this.from=r,this.modifier=n,this.context=t,this.handler=e}function e(){this.store={}}return(t=e.prototype).save=function(t,e,n,r){for(var o=u(t),a=0;a<o.length;a++)l(this.store,o[a],e,n,r)},t.get=function(t){return this.store[t]||null},t.exists=function(t){return Boolean(this.store[t])},t.remove=function(t,e,n){for(var r=u(e),o=0;o<r.length;o++)a(this.store,r[o],t,n)},e}(SC),SC.Normalizer=function(t){"use strict";var i={ctrl:0,alt:1,shift:2},c={enter:"return"},r={8:"backspace",9:"tab",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",106:"*",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",107:"+",109:"-",187:"+",188:",",189:"-",190:".",191:"/"},o={187:"+"};function e(){}return(t=e.prototype).fromEvent=function(t){e=t.keyCode;var e=!Boolean(o[e]),n=t.ctrlKey?"ctrl+":"";return(n+=t.altKey?"alt+":"")+(t.shiftKey&&e?"shift+":"")+(n=t.keyCode,e=r[n],n=96<=(t=n)&&t<=105?t-48:t,e||String.fromCharCode(n).toLowerCase())},t.normalize=function(t){var e,n;if(null==t)return t;for(n=t.split(", "),e=0;e<n.length;e++)n[e]=function(t){var e,n,r,o=[],a=[];if("+"===t)return"+";for(n=t.toLowerCase().split("+"),e=0;e<n.length;e++)void 0!==(r=function(t){return i[t]}(n[e]))?o[r]=n[e]:(r=function(t){return c[t]||t}(n[e]),a.push(r));return(o=(o=o.concat(a)).filter(function(t){return t})).join("+")}(n[e]);return n.join(", ")},e}(void SC),SC.Manager=function(n,t){"use strict";var e,a=new n.Normalizer,r=!1,o={},i=[];function c(t){this.context=n.scdefault,this.layer=e,this.isStatic=t||!1}function s(t){r&&console.debug(t)}function l(t){var e=t;return t!==window&&t!==document||(e="[window]"),t===document.body&&(e="[body]"),"string"!=typeof t&&(e=function(t){var e,n,r=t.nodeName,o=t.parentNode;for(;o;)n=o.className?"."+o.className:"",e=o.id?"#"+o.id:"",r=o.nodeName+e+n+"/"+r,o=o.parentNode;return r||t}(t)),o[e]=o[e]||new n.Store,o[e]}function u(){return 0===i.length?l(n.sclayer):i[i.length-1]}return n.scdefault=window,n.sclayer=window,e=l(n.sclayer),(t=c.prototype).create=function(t,e){return(new n.Manager).in(t,e)},t.in=function(t,e){if(this.isStatic)throw"ShortcutManager: Can not change context on static method. Use ShortcutManager.create() with right context.";return this.context=t,this.layer=l(e||n.sclayer),this},t.on=function(t,e,n){var r=a.normalize(t);this.layer.save(r,this.context,e,n),s("ShortcutManager: Register "+t)},t.activate=function(){var t;e===this.layer?(i=[],s("ShortcutManager: Activating main layer store.")):-1===(t=i.indexOf(this.layer))?i.push(this.layer):i.splice(t+1)},t.deactivate=function(){var t;if(e===this.layer)throw"ShortcutManager: Can not deactivate main layer. This is invalid call of deactivate method.";if(-1===(t=i.indexOf(this.layer)))throw"ShortcutManager: Can not deactivate layer because is not an active layer.";i.splice(t)},t.normalize=function(t){return"object"==typeof t?a.fromEvent(t):a.normalize(t)},t.remove=function(t,e){var n=a.normalize(t);this.layer.remove(this.context,n,e),s("ShortcutManager: Remove "+t)},t.event=function(t){var e,n,r,o=a.fromEvent(t);if(o)if((n=u().get(o))&&n.length){for(s("ShortcutManager: Trying to handle '"+o+"' shortcut,"),r=n.length-1;0<=r;r--){if((e=n[r]).handler(o,e.modifier,e.from,t))return s("ShortcutManager: Handler with index '"+r+"' handled shortcut, handler: "),s(e.handler),!0;s("ShortcutManager: Handler with index '"+r+"' returned false...trying next")}s("ShortcutManager: There is no more handler to try, returning false")}else s("ShortcutManager: There is no handler for '"+o+"' shortcut");return!1},t.exists=function(t){var e;return"string"==typeof(t="object"==typeof t?a.fromEvent(t):t)&&(t=a.normalize(t)),s((e=u().exists(t))?"ShortcutManager: Shortcut '"+t+"' is registered":"ShortcutManager: Shortcut '"+t+"' is not registered"),e},t.destroy=function(){this.remove()},t.debugMode=function(t){r=t,console.info("ShortcutManager debug mode is set to "+(t?"on":"off"))},c}(SC),globalThis.ShortcutManager&&console.warn("ShortcutManager already exists on globalThis, redefining"),globalThis.ShortcutManager=new SC.Manager(!0);